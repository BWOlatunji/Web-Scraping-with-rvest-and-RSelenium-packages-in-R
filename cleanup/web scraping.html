<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Web Scraping with rvest and RSelenium in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="web scraping_files/libs/clipboard/clipboard.min.js"></script>
<script src="web scraping_files/libs/quarto-html/quarto.js"></script>
<script src="web scraping_files/libs/quarto-html/popper.min.js"></script>
<script src="web scraping_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="web scraping_files/libs/quarto-html/anchor.min.js"></script>
<link href="web scraping_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="web scraping_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="web scraping_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="web scraping_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="web scraping_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Web Scraping with rvest and RSelenium in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction-to-web-scraping" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-web-scraping">1. Introduction to Web scraping</h2>
<p>Web scraping is a technique used to collect content and data from the internet. This data is usually saved in a local file so that it can be manipulated and analyzed as needed. Web scraping can be used for various purposes, such as extracting information from websites, scraping social media posts, scraping product reviews, scraping prices, and more.</p>
<p>Some of the tools that can be used to perform web scraping in R are the <code>rvest</code> and <code>RSelenium</code> package.</p>
<p><code>rvest</code> helps you scrape (or harvest) data from web pages. It is designed to work with <code>magrittr</code> to make it easy to express common web scraping tasks, inspired by libraries like beautiful soup and RoboBrowser.</p>
<p><code>RSelenium</code> on the other hand provides a set of R bindings for the Selenium WebDriver, which is a tool that allows driving a web browser natively as a user would either locally or on a remote machine using the <code>Selenium</code> server. <code>Selenium</code> automates web browsers and can interact with dynamic web pages that use JavaScript, Ajax, or other technologies.</p>
<p>In this blog post, I will explain step by step how to do web scraping in R using the <code>rvest</code> and <code>RSelenium</code> package. I will use an example of scraping the <strong>2023 Nigeria Presidential Election</strong> results from <a href="https://www.stears.co/">Stears website</a>.</p>
</section>
<section id="installing-the-libraries" class="level2">
<h2 class="anchored" data-anchor-id="installing-the-libraries">Installing the libraries</h2>
<p>To get started, we need to install the <code>rvest</code> and <code>RSelenium</code> packages as well as some supporting packages - <code>wdman</code>, <code>netstat</code>, and our trusty <code>tidyverse</code> package. To install these packages, run the script below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rvest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Installing rvest [1.0.3] ...
    OK [linked cache in 0.97 milliseconds]
* Installed 1 package in 4.6 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"RSelenium"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Installing RSelenium [1.7.9] ...
    OK [linked cache in 0.75 milliseconds]
* Installed 1 package in 0.21 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"wdman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Installing wdman [0.2.6] ...
    OK [linked cache in 0.75 milliseconds]
* Installed 1 package in 80 milliseconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"netstat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Installing netstat [0.1.2] ...
    OK [linked cache in 0.81 milliseconds]
* Installed 1 package in 31 milliseconds.</code></pre>
</div>
</div>
<p>However, you need to have Java (also known as <strong>Java</strong> Runtime Environment or JRE) running on your computer to get <code>RSelenium</code> package working properly. I will share a link to the guidelines in the description below. You can follow this <a href="https://www.java.com/en/download/help/windows_manual_download.html">guideline</a> to download and install it on your windows laptop. <a href="https://www.youtube.com/watch?v=GnpJujF9dBw" style="font-size: 13pt;">Samer Hijjazi</a>’s YouTube video is a great resource to get the <code>RSelenium</code> package running in a simplified way. I will also share the link to the video in the description below.</p>
<p>With the installation done, we’ll continue by loading the installed packages.</p>
</section>
<section id="loading-libraries" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSelenium)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wdman)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(netstat)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="navigating-to-a-web-page" class="level3">
<h3 class="anchored" data-anchor-id="navigating-to-a-web-page">Navigating to a web page</h3>
<p>Next, we need to navigate and read the target website. In this case, the <a href="https://www.stears.co/elections/2023/president/">Nigeria Presidential election results and data 2023</a></p>
<ul>
<li>using rvest</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using rvest, navigate to the web page</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>presidential_result_page <span class="ot">&lt;-</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>(<span class="st">'https://www.stears.co/elections/2023/president/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="explore-the-html-elements" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-html-elements">Explore the HTML elements</h2>
<p>It’s time to explore what are the data we can extract from the web page now that we have access and control of it.</p>
<section id="looking-at-single-and-multiple-elements" class="level3">
<h3 class="anchored" data-anchor-id="looking-at-single-and-multiple-elements">Looking at single and multiple elements</h3>
<p>The next step is to locate and extract the web elements that contain the data that we want to scrape. You can use various functions from both the <code>rvest</code> and <code>RSelenium</code> package to do this.</p>
<ul>
<li>using rvest</li>
</ul>
<p>In the <code>rvest</code> package, these functions take an xml_document object and a selector as arguments and return an object of class xml_nodeset or a single xml_node that match the selector. A selector is a way of identifying a web element based on its attributes, such as id, name, class, tag name, CSS selector, or XPath expression.</p>
</section>
<section id="show-and-tell-on-the-web-page-in-the-browser" class="level3">
<h3 class="anchored" data-anchor-id="show-and-tell-on-the-web-page-in-the-browser">Show and tell on the web page in the browser</h3>
</section>
</section>
<section id="single-elements" class="level1">
<h1>- single elements</h1>
<p>For example, to locate and extract the bold text title - “2023 Presidential results” on the web page, you can use the html_nodes function with a CSS selector as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>president_title <span class="ot">&lt;-</span> presidential_result_page <span class="sc">%&gt;%</span> <span class="fu">html_element</span>(<span class="st">"h3.font-jakarta.hidden.md</span><span class="sc">\\</span><span class="st">:block.font-medium.text-</span><span class="sc">\\</span><span class="st">[20px</span><span class="sc">\\</span><span class="st">].leading-</span><span class="sc">\\</span><span class="st">[32px</span><span class="sc">\\</span><span class="st">]"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(president_title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{html_node}
&lt;h3 class="font-jakarta hidden md:block font-medium text-[20px] leading-[32px]"&gt;</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>This will return an xml_nodeset of 20 xml_nodes that represent the text that contain the title we want.</p>
<p>To extract the text from these xml_nodes, you can use the html_text function from the rvest package. This function takes an xml_node or an xml_nodeset as an argument and returns their text content as a character vector. For example, to extract the text from the titles object, you can run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>president_title_text <span class="ot">&lt;-</span> president_title <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(president_title_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023 Presidential results "</code></pre>
</div>
</div>
<p>This will return a character vector.</p>
</section>
<section id="multiple-elements" class="level1">
<h1>- multiple elements</h1>
<p>Similarly, to locate and extract the 3 paragraph below the title we just scraped from the website. Let’s take a look at the pagraph to know which selector to use. Then we can use the html_elements function with another CSS selector as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>summary_paragraphs <span class="ot">&lt;-</span> presidential_result_page <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">'.-md</span><span class="sc">\\</span><span class="st">:hidden.mt-1.text-gray-600.text-sm'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_paragraphs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (3)}
[1] &lt;p class="-md:hidden mt-1 text-gray-600 text-sm"&gt;The winning candidate mu ...
[2] &lt;p class="-md:hidden mt-1 text-gray-600 text-sm"&gt;These results are source ...
[3] &lt;p class="-md:hidden mt-1 text-gray-600 text-sm"&gt;Declared results have be ...</code></pre>
</div>
</div>
<p>This will return an xml_nodeset of 3 xml_nodes that represent the paragraphs that contain the summary of the election results.</p>
<p>To extract the text from these xml_nodes, you can use the html_text function again as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>summary_paragraphs_text <span class="ot">&lt;-</span> summary_paragraphs <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_paragraphs_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The winning candidate must secure the majority\n            of the vote and at least 25% of the vote in two thirds of the states."       
[2] "These results are sourced from INEC's result viewing platform (IREV) and LGA collation centres and should not be taken as final results."
[3] "Declared results have been announced by INEC in Abuja. Provisional results reflect collation only at the Local Government Area level."   </code></pre>
</div>
</div>
<p>This will return a character vector of 3 strings.</p>
<p>Step 4: Store and manipulate the scraped data The final step is to store and manipulate the scraped data as needed. You can use various functions from R to do this. For example, you can create a data frame from the scraped data using the data.frame function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">paragraph =</span> summary_paragraphs_text)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(data_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>using RSelenium</li>
</ul>
<p>It’s a bit different when using the RSelenium package. First, we need to start a Selenium server and a web browser that will be used for web scraping. You can use the <code>rsDriver()</code> function from the RSelenium package to do this. This function will automatically download the necessary files and start the server and the browser. You can specify the browser name, version, and platform as arguments to this function. For example, to start a Firefox browser on Windows, you can run the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rD &lt;- rsDriver(browser = "firefox", version = "latest", platform = "WINDOWS")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will return an object that contains two elements: server and client. The server element is an object of class wdman, which represents the Selenium server. The client element is an object of class remoteDriver, which represents the web browser. You can access these elements using the $ operator. For example, to access the client element, you can run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remDr &lt;- rD$client</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this tutorial, I will be using the chrome browser as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remote driver session using rsDriver() from  the RSelenium package</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>rs_driver_object <span class="ot">&lt;-</span> <span class="fu">rsDriver</span>(<span class="at">browser =</span> <span class="st">'chrome'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chromever =</span> <span class="st">"118.0.5993.70"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># from netstat package</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># generates a free ports i.e. TCP</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">port =</span> <span class="fu">free_port</span>(),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>remDr <span class="ot">&lt;-</span> rs_driver_object<span class="sc">$</span>client</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step is to navigate to the target website that you want to scrape. You can use the <code>navigate()</code> function from the <code>RSelenium</code> package to do this. This function takes a <strong><em>remoteDriver</em></strong> object and a URL as arguments and opens the URL in the web browser.</p>
<p>For example, to navigate to the election results website, you can run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Navigate to the webpage</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remDr$navigate('https://www.stears.co/elections/2023/president/')</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>election_result_url <span class="ot">&lt;-</span> <span class="st">'https://www.stears.co/elections/2023/president/'</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>remDr<span class="sc">$</span><span class="fu">navigate</span>(election_result_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will open the website in the Chrome browser. These functions take a remoteDriver object and a locator strategy as arguments and return an object of class webElement or a list of webElements. A locator strategy is a way of identifying a web element based on its attributes, such as id, name, class, tag name, CSS selector, or XPath expression. For example, to locate and extract the titles of books from the website, you can use the findElements function with a CSS selector as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># election_result_url &lt;- 'https://www.stears.co/elections/2023/president/'</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remDr$navigate(election_result_url)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>president_title <span class="ot">&lt;-</span> remDr<span class="sc">$</span><span class="fu">findElement</span>(<span class="at">using =</span> <span class="st">'css'</span>, <span class="st">'.font-jakarta.hidden.md</span><span class="sc">\\</span><span class="st">:block.font-medium.text-</span><span class="sc">\\</span><span class="st">[20px</span><span class="sc">\\</span><span class="st">].leading-</span><span class="sc">\\</span><span class="st">[32px</span><span class="sc">\\</span><span class="st">]'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>president_title_text <span class="ot">&lt;-</span> president_title<span class="sc">$</span><span class="fu">getElementText</span>()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(president_title_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "2023 Presidential results"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>summary_paragraphs <span class="ot">&lt;-</span> remDr<span class="sc">$</span><span class="fu">findElements</span>(<span class="at">using =</span> <span class="st">'css'</span>, <span class="st">'.-md</span><span class="sc">\\</span><span class="st">:hidden.mt-1.text-gray-600.text-sm'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>summary_paragraphs_text <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(summary_paragraphs, <span class="cf">function</span>(x) x<span class="sc">$</span><span class="fu">getElementText</span>()))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_paragraphs_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The winning candidate must secure the majority of the vote and at least 25% of the vote in two thirds of the states."                    
[2] "These results are sourced from INEC's result viewing platform (IREV) and LGA collation centres and should not be taken as final results."
[3] "Declared results have been announced by INEC in Abuja. Provisional results reflect collation only at the Local Government Area level."   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">paragraph =</span> summary_paragraphs_text)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(data_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="presidential-resultsits-time-to-look-at-a-practical-use-case.-in-this-tutorial-its-going-to-be-2023-nigeria-presidential-election." class="level3">
<h3 class="anchored" data-anchor-id="presidential-resultsits-time-to-look-at-a-practical-use-case.-in-this-tutorial-its-going-to-be-2023-nigeria-presidential-election.">2023 Presidential resultsIt’s time to look at a practical use case. In this tutorial, it’s going to be 2023 Nigeria Presidential election.</h3>
<ul>
<li>Summarized results We look at the summarized result data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all state names</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>summary_div <span class="ot">&lt;-</span> presidential_result_page <span class="sc">|&gt;</span> <span class="fu">html_elements</span>(<span class="st">"div.mb-4"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>summarised_result_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="at">candidate_name =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.text-p_15_15.font-medium.text-gray-800"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>(),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># party</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="at">candidate_party =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"div"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_15_15.font-light.text-gray-600"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>(),</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># total result</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="at">total_result =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"div"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_12_12.font-light.text-gray-800"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>(),</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># percentage of result</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="at">pct_result =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"div"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_12_12.font-light.text-gray-600.ml-1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scrape-all-results-down-to-state-and-lga-levels" class="level2">
<h2 class="anchored" data-anchor-id="scrape-all-results-down-to-state-and-lga-levels">Scrape all results down to State and LGA levels</h2>
<p>First, we need extract the state urls, or web address where we can get all results at the lga levels</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find and click the "Select State" drop-down</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>state_dropdown <span class="ot">&lt;-</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  remDr<span class="sc">$</span><span class="fu">findElement</span>(<span class="at">using =</span> <span class="st">'id'</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'headlessui-menu-button-:R356t6:'</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the dropdown is clicked to open it</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>state_dropdown<span class="sc">$</span><span class="fu">clickElement</span>()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># scrape all state url from their generated anchors</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>page_source <span class="ot">&lt;-</span> remDr<span class="sc">$</span><span class="fu">getPageSource</span>()</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(page_source[[<span class="dv">1</span>]])</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>state_anchor_hrefs <span class="ot">&lt;-</span> page  <span class="sc">|&gt;</span>  </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".flex.flex-col.justify-start.align-middle"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"a.text-gray-800"</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate the main URL to each element of the state_anchors_href vector</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># to generate the state results full URLs</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>state_results_urls <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://www.stears.co"</span>, state_anchor_hrefs, <span class="at">sep =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s extract the results for all states and lgas. But let’s start by extracting for the first state, Abia State.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>abia_state_page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(state_results_urls[[<span class="dv">1</span>]])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all state names</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>abia_result_tables <span class="ot">&lt;-</span> abia_state_page <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>abia_lga_names <span class="ot">&lt;-</span> abia_state_page <span class="sc">|&gt;</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_20.font-medium.-md</span><span class="sc">\\</span><span class="st">:hidden.mt-10.capitalize"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(abia_lga_names)</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>abia_state_name <span class="ot">&lt;-</span> abia_state_page <span class="sc">|&gt;</span>  </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"h1.w-full.h-12.font-bold.font-jakarta.text-</span><span class="sc">\\</span><span class="st">[28px</span><span class="sc">\\</span><span class="st">].leading-</span><span class="sc">\\</span><span class="st">[40px</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># print(abia_state_name)</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># first lga i.e. Umuahia North</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>Umuahia_North_lga_tbl <span class="ot">&lt;-</span> abia_result_tables[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">LGA=</span>abia_lga_names[[<span class="dv">1</span>]],</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">STATE=</span>abia_state_name,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>                             <span class="at">.before =</span> <span class="st">"Candidate"</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print(Umuahia_North_lga_tbl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s time to use the same steps that we used for a single state for all the other states by using the for loop to iterate through the states and the lgas one by one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>all_states_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through the url for each state</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (state_results_url <span class="cf">in</span> state_results_urls) {</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  state_page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(state_results_url)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract all state results by lga. The result for each lga is kept in a table</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># on the page</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  result_tables <span class="ot">&lt;-</span> state_page <span class="sc">|&gt;</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_table</span>()</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  lga_names <span class="ot">&lt;-</span> state_page <span class="sc">|&gt;</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_20.font-medium.-md</span><span class="sc">\\</span><span class="st">:hidden.mt-10.capitalize"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  state_name <span class="ot">&lt;-</span> state_page <span class="sc">|&gt;</span>  </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"h1.w-full.h-12.font-bold.font-jakarta.text-</span><span class="sc">\\</span><span class="st">[28px</span><span class="sc">\\</span><span class="st">].leading-</span><span class="sc">\\</span><span class="st">[40px</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate through the list of tables and add the STATE and LGA columns</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lga_names)) {</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reference each table using their indices</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    table_index <span class="ot">&lt;-</span> i</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    current_table <span class="ot">&lt;-</span> result_tables[[table_index]]</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add LGA and STATE columns to the current table using the vector element</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    current_table[<span class="st">"LGA"</span>] <span class="ot">&lt;-</span> lga_names[i]</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    current_table[<span class="st">"STATE"</span>] <span class="ot">&lt;-</span> state_name</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the current table in the list</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    result_tables[[table_index]] <span class="ot">&lt;-</span> current_table</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  all_states_results <span class="ot">&lt;-</span> <span class="fu">append</span>(all_states_results, result_tables)</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="print-out-the-result" class="level3">
<h3 class="anchored" data-anchor-id="print-out-the-result">Print out the result</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the modified list of tables</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_states_results[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 7
   Candidate                     Party `Votes Margin` Votes  Percent LGA   STATE
   &lt;chr&gt;                         &lt;chr&gt; &lt;lgl&gt;          &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
 1 Obi Peter Gregory             LP    NA             51,318 94.10%  Umua… Abia…
 2 Abubakar Atiku                PDP   NA             1,529  2.80%   Umua… Abia…
 3 Tinubu Bola Ahmed             APC   NA             795    1.46%   Umua… Abia…
 4 Umeadi Peter Nnanna Chukwudi  APGA  NA             190    0.35%   Umua… Abia…
 5 Kachikwu Dumebi               ADC   NA             124    0.23%   Umua… Abia…
 6 Ado-Ibrahim Abdulmalik        YPP   NA             113    0.21%   Umua… Abia…
 7 Musa Mohammed Rabiu Kwankwaso NNPP  NA             112    0.21%   Umua… Abia…
 8 Nwanyanwu Daniel Daberechukwu ZLP   NA             91     0.17%   Umua… Abia…
 9 Adenuga Sunday Oluwafemi      BP    NA             52     0.10%   Umua… Abia…
10 Ojei Princess Chichi          APM   NA             48     0.09%   Umua… Abia…
11 Imumolen Irene Christopher    A     NA             42     0.08%   Umua… Abia…
12 Nnadi Charles Osita           APP   NA             33     0.06%   Umua… Abia…
13 Sani Yabagi Yusuf             ADP   NA             28     0.05%   Umua… Abia…
14 Sowore Omoyele Stephen        AAC   NA             17     0.03%   Umua… Abia…
15 Almustapha Hamza              AA    NA             15     0.03%   Umua… Abia…
16 Adebayo Adewole Ebenezer      SDP   NA             11     0.02%   Umua… Abia…
17 Osakwe Felix Johnson          NRM   NA             10     0.02%   Umua… Abia…
18 Abiola Latifu Kolawole        PRP   NA             10     0.02%   Umua… Abia…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_states_results[[<span class="dv">100</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 7
   Candidate                     Party `Votes Margin` Votes Percent LGA    STATE
   &lt;chr&gt;                         &lt;chr&gt; &lt;lgl&gt;          &lt;lgl&gt; &lt;lgl&gt;   &lt;chr&gt;  &lt;chr&gt;
 1 Tinubu Bola Ahmed             APC   NA             NA    NA      Alkal… Bauc…
 2 Abubakar Atiku                PDP   NA             NA    NA      Alkal… Bauc…
 3 Obi Peter Gregory             LP    NA             NA    NA      Alkal… Bauc…
 4 Musa Mohammed Rabiu Kwankwaso NNPP  NA             NA    NA      Alkal… Bauc…
 5 Kachikwu Dumebi               ADC   NA             NA    NA      Alkal… Bauc…
 6 Umeadi Peter Nnanna Chukwudi  APGA  NA             NA    NA      Alkal… Bauc…
 7 Sani Yabagi Yusuf             ADP   NA             NA    NA      Alkal… Bauc…
 8 Imumolen Irene Christopher    A     NA             NA    NA      Alkal… Bauc…
 9 Almustapha Hamza              AA    NA             NA    NA      Alkal… Bauc…
10 Sowore Omoyele Stephen        AAC   NA             NA    NA      Alkal… Bauc…
11 Ojei Princess Chichi          APM   NA             NA    NA      Alkal… Bauc…
12 Nnadi Charles Osita           APP   NA             NA    NA      Alkal… Bauc…
13 Adenuga Sunday Oluwafemi      BP    NA             NA    NA      Alkal… Bauc…
14 Osakwe Felix Johnson          NRM   NA             NA    NA      Alkal… Bauc…
15 Abiola Latifu Kolawole        PRP   NA             NA    NA      Alkal… Bauc…
16 Adebayo Adewole Ebenezer      SDP   NA             NA    NA      Alkal… Bauc…
17 Ado-Ibrahim Abdulmalik        YPP   NA             NA    NA      Alkal… Bauc…
18 Nwanyanwu Daniel Daberechukwu ZLP   NA             NA    NA      Alkal… Bauc…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_states_results[[<span class="dv">774</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 7
   Candidate                     Party `Votes Margin` Votes  Percent LGA   STATE
   &lt;chr&gt;                         &lt;chr&gt; &lt;lgl&gt;          &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
 1 Tinubu Bola Ahmed             APC   NA             10,370 50.70%  Abaji Fede…
 2 Abubakar Atiku                PDP   NA             6,888  33.68%  Abaji Fede…
 3 Obi Peter Gregory             LP    NA             2,874  14.05%  Abaji Fede…
 4 Musa Mohammed Rabiu Kwankwaso NNPP  NA             104    0.51%   Abaji Fede…
 5 Nwanyanwu Daniel Daberechukwu ZLP   NA             59     0.29%   Abaji Fede…
 6 Kachikwu Dumebi               ADC   NA             47     0.23%   Abaji Fede…
 7 Sani Yabagi Yusuf             ADP   NA             25     0.12%   Abaji Fede…
 8 Umeadi Peter Nnanna Chukwudi  APGA  NA             24     0.12%   Abaji Fede…
 9 Adebayo Adewole Ebenezer      SDP   NA             13     0.06%   Abaji Fede…
10 Almustapha Hamza              AA    NA             9      0.04%   Abaji Fede…
11 Ojei Princess Chichi          APM   NA             9      0.04%   Abaji Fede…
12 Osakwe Felix Johnson          NRM   NA             9      0.04%   Abaji Fede…
13 Ado-Ibrahim Abdulmalik        YPP   NA             7      0.03%   Abaji Fede…
14 Imumolen Irene Christopher    A     NA             5      0.02%   Abaji Fede…
15 Abiola Latifu Kolawole        PRP   NA             5      0.02%   Abaji Fede…
16 Sowore Omoyele Stephen        AAC   NA             2      0.01%   Abaji Fede…
17 Nnadi Charles Osita           APP   NA             2      0.01%   Abaji Fede…
18 Adenuga Sunday Oluwafemi      BP    NA             2      0.01%   Abaji Fede…</code></pre>
</div>
</div>
</section>
<section id="data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h3>
<p>Hurray, we did it. Now, as a data analyst we can do better by manipulating the data to get a somewhat clean and neat data. First, we don’t nee the Votes Margin column. So, we take it out. Next, we replace all the NAs with the appropriate replacement values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind all tables in the all_states_results together</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>combined_tibble <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_states_results) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Votes Margin</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">Votes=</span><span class="st">"0"</span>,<span class="at">Percent=</span><span class="st">"0%"</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,932 × 6
   Candidate                     Party Votes  Percent LGA           STATE     
   &lt;chr&gt;                         &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;     
 1 Obi Peter Gregory             LP    51,318 94.10%  Umuahia North Abia State
 2 Abubakar Atiku                PDP   1,529  2.80%   Umuahia North Abia State
 3 Tinubu Bola Ahmed             APC   795    1.46%   Umuahia North Abia State
 4 Umeadi Peter Nnanna Chukwudi  APGA  190    0.35%   Umuahia North Abia State
 5 Kachikwu Dumebi               ADC   124    0.23%   Umuahia North Abia State
 6 Ado-Ibrahim Abdulmalik        YPP   113    0.21%   Umuahia North Abia State
 7 Musa Mohammed Rabiu Kwankwaso NNPP  112    0.21%   Umuahia North Abia State
 8 Nwanyanwu Daniel Daberechukwu ZLP   91     0.17%   Umuahia North Abia State
 9 Adenuga Sunday Oluwafemi      BP    52     0.10%   Umuahia North Abia State
10 Ojei Princess Chichi          APM   48     0.09%   Umuahia North Abia State
# ℹ 13,922 more rows</code></pre>
</div>
</div>
<p>At last, we’ve completed the tutorial. I hope you have been able to add web scraping to your skill toolbox. I look forward to hearing what you’ll achieve with it in the nearest future. Thank you and stay leaning.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>