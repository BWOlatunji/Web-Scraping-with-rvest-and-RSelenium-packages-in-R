<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Web Scraping with rvest and RSelenium in R, Use Case</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="web scraping case study_files/libs/clipboard/clipboard.min.js"></script>
<script src="web scraping case study_files/libs/quarto-html/quarto.js"></script>
<script src="web scraping case study_files/libs/quarto-html/popper.min.js"></script>
<script src="web scraping case study_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="web scraping case study_files/libs/quarto-html/anchor.min.js"></script>
<link href="web scraping case study_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="web scraping case study_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="web scraping case study_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="web scraping case study_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="web scraping case study_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Web Scraping with rvest and RSelenium in R, Use Case</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="loading-libraries" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSelenium)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(netstat)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="read-the-web-page" class="level2">
<h2 class="anchored" data-anchor-id="read-the-web-page">Read the web page</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Navigate to the webpage</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using rvest, navigate to the web page</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>presidential_result_page <span class="ot">&lt;-</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>(<span class="st">'https://www.stears.co/elections/2023/president/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="presidential-results" class="level3">
<h3 class="anchored" data-anchor-id="presidential-results">2023 Presidential results</h3>
<ul>
<li>Summarized results</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all state names</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>summary_div <span class="ot">&lt;-</span> presidential_result_page <span class="sc">|&gt;</span> <span class="fu">html_elements</span>(<span class="st">"div.mb-4"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>summarised_result_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">candidate_name =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.text-p_15_15.font-medium.text-gray-800"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># party</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">candidate_party =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"div"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_15_15.font-light.text-gray-600"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>(),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># total result</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="at">total_result =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"div"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_12_12.font-light.text-gray-800"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>(),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># percentage of result</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="at">pct_result =</span> summary_div <span class="sc">|&gt;</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"article.border-gray-10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"div"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_12_12.font-light.text-gray-600.ml-1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="start-selenium-server-and-using-the-chrome-browser" class="level2">
<h2 class="anchored" data-anchor-id="start-selenium-server-and-using-the-chrome-browser">Start Selenium server, and using the Chrome browser</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remote driver session using rsDriver() from  the RSelenium package</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>rs_driver_object <span class="ot">&lt;-</span> <span class="fu">rsDriver</span>(<span class="at">browser =</span> <span class="st">'chrome'</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chromever =</span> <span class="st">"118.0.5993.70"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># from netstat package</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">port =</span> <span class="fu">free_port</span>(),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>remDr <span class="ot">&lt;-</span> rs_driver_object<span class="sc">$</span>client</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Navigate to the web page</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>election_result_url <span class="ot">&lt;-</span> <span class="st">'https://www.stears.co/elections/2023/president/'</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>remDr<span class="sc">$</span><span class="fu">navigate</span>(election_result_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scrape-all-results-down-to-state-and-lga-levels" class="level2">
<h2 class="anchored" data-anchor-id="scrape-all-results-down-to-state-and-lga-levels">Scrape all results down to State and LGA levels</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find and click the "Select State" drop-down</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>state_dropdown <span class="ot">&lt;-</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  remDr<span class="sc">$</span><span class="fu">findElement</span>(<span class="at">using =</span> <span class="st">'id'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'headlessui-menu-button-:R356t6:'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the dropdown is clicked to open it</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>state_dropdown<span class="sc">$</span><span class="fu">clickElement</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># scrape all state url from their generated anchors</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>page_source <span class="ot">&lt;-</span> remDr<span class="sc">$</span><span class="fu">getPageSource</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(page_source[[<span class="dv">1</span>]])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>state_anchor_hrefs <span class="ot">&lt;-</span> page  <span class="sc">|&gt;</span>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".flex.flex-col.justify-start.align-middle"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"a.text-gray-800"</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(state_anchor_hrefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "/elections/2023/president/AB/"  "/elections/2023/president/AD/" 
 [3] "/elections/2023/president/AK/"  "/elections/2023/president/AN/" 
 [5] "/elections/2023/president/BA/"  "/elections/2023/president/BY/" 
 [7] "/elections/2023/president/BE/"  "/elections/2023/president/BO/" 
 [9] "/elections/2023/president/CR/"  "/elections/2023/president/DE/" 
[11] "/elections/2023/president/EB/"  "/elections/2023/president/ED/" 
[13] "/elections/2023/president/EK/"  "/elections/2023/president/EN/" 
[15] "/elections/2023/president/GO/"  "/elections/2023/president/IM/" 
[17] "/elections/2023/president/JI/"  "/elections/2023/president/KD/" 
[19] "/elections/2023/president/KN/"  "/elections/2023/president/KT/" 
[21] "/elections/2023/president/KE/"  "/elections/2023/president/KO/" 
[23] "/elections/2023/president/KW/"  "/elections/2023/president/LA/" 
[25] "/elections/2023/president/NA/"  "/elections/2023/president/NI/" 
[27] "/elections/2023/president/OG/"  "/elections/2023/president/ON/" 
[29] "/elections/2023/president/OS/"  "/elections/2023/president/OY/" 
[31] "/elections/2023/president/PL/"  "/elections/2023/president/RI/" 
[33] "/elections/2023/president/SO/"  "/elections/2023/president/TA/" 
[35] "/elections/2023/president/YO/"  "/elections/2023/president/ZA/" 
[37] "/elections/2023/president/FCT/"</code></pre>
</div>
</div>
<p>Next, we concatenate the main URL to each element of the state_anchors_href vector to generate the state results full URLs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>state_results_urls <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://www.stears.co"</span>, state_anchor_hrefs, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(state_results_urls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "https://www.stears.co/elections/2023/president/AB/" 
 [2] "https://www.stears.co/elections/2023/president/AD/" 
 [3] "https://www.stears.co/elections/2023/president/AK/" 
 [4] "https://www.stears.co/elections/2023/president/AN/" 
 [5] "https://www.stears.co/elections/2023/president/BA/" 
 [6] "https://www.stears.co/elections/2023/president/BY/" 
 [7] "https://www.stears.co/elections/2023/president/BE/" 
 [8] "https://www.stears.co/elections/2023/president/BO/" 
 [9] "https://www.stears.co/elections/2023/president/CR/" 
[10] "https://www.stears.co/elections/2023/president/DE/" 
[11] "https://www.stears.co/elections/2023/president/EB/" 
[12] "https://www.stears.co/elections/2023/president/ED/" 
[13] "https://www.stears.co/elections/2023/president/EK/" 
[14] "https://www.stears.co/elections/2023/president/EN/" 
[15] "https://www.stears.co/elections/2023/president/GO/" 
[16] "https://www.stears.co/elections/2023/president/IM/" 
[17] "https://www.stears.co/elections/2023/president/JI/" 
[18] "https://www.stears.co/elections/2023/president/KD/" 
[19] "https://www.stears.co/elections/2023/president/KN/" 
[20] "https://www.stears.co/elections/2023/president/KT/" 
[21] "https://www.stears.co/elections/2023/president/KE/" 
[22] "https://www.stears.co/elections/2023/president/KO/" 
[23] "https://www.stears.co/elections/2023/president/KW/" 
[24] "https://www.stears.co/elections/2023/president/LA/" 
[25] "https://www.stears.co/elections/2023/president/NA/" 
[26] "https://www.stears.co/elections/2023/president/NI/" 
[27] "https://www.stears.co/elections/2023/president/OG/" 
[28] "https://www.stears.co/elections/2023/president/ON/" 
[29] "https://www.stears.co/elections/2023/president/OS/" 
[30] "https://www.stears.co/elections/2023/president/OY/" 
[31] "https://www.stears.co/elections/2023/president/PL/" 
[32] "https://www.stears.co/elections/2023/president/RI/" 
[33] "https://www.stears.co/elections/2023/president/SO/" 
[34] "https://www.stears.co/elections/2023/president/TA/" 
[35] "https://www.stears.co/elections/2023/president/YO/" 
[36] "https://www.stears.co/elections/2023/president/ZA/" 
[37] "https://www.stears.co/elections/2023/president/FCT/"</code></pre>
</div>
</div>
<p>For example, first state Abia State</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>abia_state_page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(state_results_urls[[<span class="dv">1</span>]])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all state names</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>abia_result_tables <span class="ot">&lt;-</span> abia_state_page <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>abia_lga_names <span class="ot">&lt;-</span> abia_state_page <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_20.font-medium.-md</span><span class="sc">\\</span><span class="st">:hidden.mt-10.capitalize"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(abia_lga_names)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>abia_state_name <span class="ot">&lt;-</span> abia_state_page <span class="sc">|&gt;</span>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">"h1.w-full.h-12.font-bold.font-jakarta.text-</span><span class="sc">\\</span><span class="st">[28px</span><span class="sc">\\</span><span class="st">].leading-</span><span class="sc">\\</span><span class="st">[40px</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text2</span>()</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># print(abia_state_name)</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># first lga i.e. Umuahia North</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>Umuahia_North_lga_tbl <span class="ot">&lt;-</span> abia_result_tables[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">LGA=</span>abia_lga_names[[<span class="dv">1</span>]],</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">STATE=</span>abia_state_name,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                             <span class="at">.before =</span> <span class="st">"Candidate"</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print(Umuahia_North_lga_tbl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="get-all-results-tables-states-and-lgas" class="level2">
<h2 class="anchored" data-anchor-id="get-all-results-tables-states-and-lgas">Get all results tables: states and lgas</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>all_states_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through the url for each state</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (state_results_url <span class="cf">in</span> state_results_urls) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  state_page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(state_results_url)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract all state results by lga. The result for each lga is kept in a table</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># on the page</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  result_tables <span class="ot">&lt;-</span> state_page <span class="sc">|&gt;</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_table</span>()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  lga_names <span class="ot">&lt;-</span> state_page <span class="sc">|&gt;</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"div.px-6.py-10.bg-white.md</span><span class="sc">\\</span><span class="st">:px-8.md</span><span class="sc">\\</span><span class="st">:py-6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"section.mb-4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"p.font-jakarta.font-jakarta.text-p_20.font-medium.-md</span><span class="sc">\\</span><span class="st">:hidden.mt-10.capitalize"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  state_name <span class="ot">&lt;-</span> state_page <span class="sc">|&gt;</span>  </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"h1.w-full.h-12.font-bold.font-jakarta.text-</span><span class="sc">\\</span><span class="st">[28px</span><span class="sc">\\</span><span class="st">].leading-</span><span class="sc">\\</span><span class="st">[40px</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate through the list of tables and add the STATE and LGA columns</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lga_names)) {</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reference each table using their indices</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    table_index <span class="ot">&lt;-</span> i</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    current_table <span class="ot">&lt;-</span> result_tables[[table_index]]</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add LGA and STATE columns to the current table using the vector element</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    current_table[<span class="st">"LGA"</span>] <span class="ot">&lt;-</span> lga_names[i]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    current_table[<span class="st">"STATE"</span>] <span class="ot">&lt;-</span> state_name</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the current table in the list</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    result_tables[[table_index]] <span class="ot">&lt;-</span> current_table</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  all_states_results <span class="ot">&lt;-</span> <span class="fu">append</span>(all_states_results, result_tables)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="print-out-the-result" class="level3">
<h3 class="anchored" data-anchor-id="print-out-the-result">Print out the result</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the modified list of tables</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_states_results[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 7
   Candidate                     Party `Votes Margin` Votes  Percent LGA   STATE
   &lt;chr&gt;                         &lt;chr&gt; &lt;lgl&gt;          &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
 1 Obi Peter Gregory             LP    NA             51,318 94.10%  Umua… Abia…
 2 Abubakar Atiku                PDP   NA             1,529  2.80%   Umua… Abia…
 3 Tinubu Bola Ahmed             APC   NA             795    1.46%   Umua… Abia…
 4 Umeadi Peter Nnanna Chukwudi  APGA  NA             190    0.35%   Umua… Abia…
 5 Kachikwu Dumebi               ADC   NA             124    0.23%   Umua… Abia…
 6 Ado-Ibrahim Abdulmalik        YPP   NA             113    0.21%   Umua… Abia…
 7 Musa Mohammed Rabiu Kwankwaso NNPP  NA             112    0.21%   Umua… Abia…
 8 Nwanyanwu Daniel Daberechukwu ZLP   NA             91     0.17%   Umua… Abia…
 9 Adenuga Sunday Oluwafemi      BP    NA             52     0.10%   Umua… Abia…
10 Ojei Princess Chichi          APM   NA             48     0.09%   Umua… Abia…
11 Imumolen Irene Christopher    A     NA             42     0.08%   Umua… Abia…
12 Nnadi Charles Osita           APP   NA             33     0.06%   Umua… Abia…
13 Sani Yabagi Yusuf             ADP   NA             28     0.05%   Umua… Abia…
14 Sowore Omoyele Stephen        AAC   NA             17     0.03%   Umua… Abia…
15 Almustapha Hamza              AA    NA             15     0.03%   Umua… Abia…
16 Adebayo Adewole Ebenezer      SDP   NA             11     0.02%   Umua… Abia…
17 Osakwe Felix Johnson          NRM   NA             10     0.02%   Umua… Abia…
18 Abiola Latifu Kolawole        PRP   NA             10     0.02%   Umua… Abia…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_states_results[[<span class="dv">100</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 7
   Candidate                     Party `Votes Margin` Votes Percent LGA    STATE
   &lt;chr&gt;                         &lt;chr&gt; &lt;lgl&gt;          &lt;lgl&gt; &lt;lgl&gt;   &lt;chr&gt;  &lt;chr&gt;
 1 Tinubu Bola Ahmed             APC   NA             NA    NA      Alkal… Bauc…
 2 Abubakar Atiku                PDP   NA             NA    NA      Alkal… Bauc…
 3 Obi Peter Gregory             LP    NA             NA    NA      Alkal… Bauc…
 4 Musa Mohammed Rabiu Kwankwaso NNPP  NA             NA    NA      Alkal… Bauc…
 5 Kachikwu Dumebi               ADC   NA             NA    NA      Alkal… Bauc…
 6 Umeadi Peter Nnanna Chukwudi  APGA  NA             NA    NA      Alkal… Bauc…
 7 Sani Yabagi Yusuf             ADP   NA             NA    NA      Alkal… Bauc…
 8 Imumolen Irene Christopher    A     NA             NA    NA      Alkal… Bauc…
 9 Almustapha Hamza              AA    NA             NA    NA      Alkal… Bauc…
10 Sowore Omoyele Stephen        AAC   NA             NA    NA      Alkal… Bauc…
11 Ojei Princess Chichi          APM   NA             NA    NA      Alkal… Bauc…
12 Nnadi Charles Osita           APP   NA             NA    NA      Alkal… Bauc…
13 Adenuga Sunday Oluwafemi      BP    NA             NA    NA      Alkal… Bauc…
14 Osakwe Felix Johnson          NRM   NA             NA    NA      Alkal… Bauc…
15 Abiola Latifu Kolawole        PRP   NA             NA    NA      Alkal… Bauc…
16 Adebayo Adewole Ebenezer      SDP   NA             NA    NA      Alkal… Bauc…
17 Ado-Ibrahim Abdulmalik        YPP   NA             NA    NA      Alkal… Bauc…
18 Nwanyanwu Daniel Daberechukwu ZLP   NA             NA    NA      Alkal… Bauc…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_states_results[[<span class="dv">774</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 7
   Candidate                     Party `Votes Margin` Votes  Percent LGA   STATE
   &lt;chr&gt;                         &lt;chr&gt; &lt;lgl&gt;          &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
 1 Tinubu Bola Ahmed             APC   NA             10,370 50.70%  Abaji Fede…
 2 Abubakar Atiku                PDP   NA             6,888  33.68%  Abaji Fede…
 3 Obi Peter Gregory             LP    NA             2,874  14.05%  Abaji Fede…
 4 Musa Mohammed Rabiu Kwankwaso NNPP  NA             104    0.51%   Abaji Fede…
 5 Nwanyanwu Daniel Daberechukwu ZLP   NA             59     0.29%   Abaji Fede…
 6 Kachikwu Dumebi               ADC   NA             47     0.23%   Abaji Fede…
 7 Sani Yabagi Yusuf             ADP   NA             25     0.12%   Abaji Fede…
 8 Umeadi Peter Nnanna Chukwudi  APGA  NA             24     0.12%   Abaji Fede…
 9 Adebayo Adewole Ebenezer      SDP   NA             13     0.06%   Abaji Fede…
10 Almustapha Hamza              AA    NA             9      0.04%   Abaji Fede…
11 Ojei Princess Chichi          APM   NA             9      0.04%   Abaji Fede…
12 Osakwe Felix Johnson          NRM   NA             9      0.04%   Abaji Fede…
13 Ado-Ibrahim Abdulmalik        YPP   NA             7      0.03%   Abaji Fede…
14 Imumolen Irene Christopher    A     NA             5      0.02%   Abaji Fede…
15 Abiola Latifu Kolawole        PRP   NA             5      0.02%   Abaji Fede…
16 Sowore Omoyele Stephen        AAC   NA             2      0.01%   Abaji Fede…
17 Nnadi Charles Osita           APP   NA             2      0.01%   Abaji Fede…
18 Adenuga Sunday Oluwafemi      BP    NA             2      0.01%   Abaji Fede…</code></pre>
</div>
</div>
</section>
<section id="data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind all tables in the all_states_results together</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>combined_tibble <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_states_results) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Votes Margin</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">Votes=</span><span class="st">"0"</span>,<span class="at">Percent=</span><span class="st">"0%"</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,932 × 6
   Candidate                     Party Votes  Percent LGA           STATE     
   &lt;chr&gt;                         &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;     
 1 Obi Peter Gregory             LP    51,318 94.10%  Umuahia North Abia State
 2 Abubakar Atiku                PDP   1,529  2.80%   Umuahia North Abia State
 3 Tinubu Bola Ahmed             APC   795    1.46%   Umuahia North Abia State
 4 Umeadi Peter Nnanna Chukwudi  APGA  190    0.35%   Umuahia North Abia State
 5 Kachikwu Dumebi               ADC   124    0.23%   Umuahia North Abia State
 6 Ado-Ibrahim Abdulmalik        YPP   113    0.21%   Umuahia North Abia State
 7 Musa Mohammed Rabiu Kwankwaso NNPP  112    0.21%   Umuahia North Abia State
 8 Nwanyanwu Daniel Daberechukwu ZLP   91     0.17%   Umuahia North Abia State
 9 Adenuga Sunday Oluwafemi      BP    52     0.10%   Umuahia North Abia State
10 Ojei Princess Chichi          APM   48     0.09%   Umuahia North Abia State
# ℹ 13,922 more rows</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>